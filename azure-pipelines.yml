trigger:
  branches:
    include:
      - master
      - main
      - develop
      - feature/*
  tags:
    exclude:
      - v*

pool:
  # vmImage: 'ubuntu-latest'
  vmImage: 'windows-latest'

variables:
  - name: DOTNET_CLI_TELEMETRY_OPTOUT
    value: 1
  - name: DOTNET_SKIP_FIRST_TIME_EXPERIENCE
    value: 1

workspace:
  clean: all

steps:
  - checkout: self
    persistCredentials: true
    clean: true

  - task: NuGetToolInstaller@1
    displayName: Install Nuget 5x
    inputs:
      versionSpec: '5.*'
      checkLatest: true

  - task: DotNetCoreCLI@2
    displayName: Restore
    inputs:
      command: 'restore'
      projects: '**/*.csproj'

  - task: DotNetCoreCLI@2
    displayName: Build
    inputs:
      command: 'build'
      projects: '**/*.sln'
      arguments: '--configuration Release --verbosity normal'

  - task: DotNetCoreCLI@2
    displayName: Test
    inputs:
      command: test
      projects: '**/*[Tt]est/*.csproj'
      arguments: '--configuration Release /p:CollectCoverage=true /p:CoverletOutputFormat=cobertura /p:ExcludeByAttribute=CompilerGenerated --logger trx'
